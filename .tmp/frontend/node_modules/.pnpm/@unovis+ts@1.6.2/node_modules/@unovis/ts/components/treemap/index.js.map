{"version":3,"file":"index.js","sources":["../../../src/components/treemap/index.ts"],"sourcesContent":["import { Selection, select } from 'd3-selection'\nimport { hierarchy, HierarchyNode, treemap } from 'd3-hierarchy'\nimport { group, max, extent } from 'd3-array'\nimport { scaleLinear, scaleThreshold } from 'd3-scale'\nimport { hsl } from 'd3-color'\n\n// Core\nimport { ComponentCore } from 'core/component'\n\n// Data Model\nimport { SeriesDataModel } from 'data-models/series'\n\n// Utils\nimport { getColor, brighter, getHexValue, isColorDark } from 'utils/color'\nimport { getString, getNumber, isNumber } from 'utils/data'\nimport { smartTransition } from 'utils/d3'\nimport { trimSVGText, wrapSVGText } from 'utils/text'\nimport { cssvar } from 'utils/style'\n\n// Types\nimport { FitMode } from 'types/text'\n\n// Config\nimport { TreemapConfigInterface, TreemapDefaultConfig } from './config'\n\n// Local Types\nimport { TreemapDatum, TreemapNode } from './types'\n\n// Styles\nimport * as s from './style'\n\nexport class Treemap<Datum> extends ComponentCore<Datum[], TreemapConfigInterface<Datum>> {\n  static selectors = s\n  protected _defaultConfig = TreemapDefaultConfig as TreemapConfigInterface<Datum>\n  public config: TreemapConfigInterface<Datum> = this._defaultConfig\n\n  datamodel: SeriesDataModel<Datum> = new SeriesDataModel()\n  tiles: Selection<SVGGElement, unknown, SVGGElement, unknown>\n\n  private _isTileLargeEnough (d: TreemapNode<Datum>): boolean {\n    const w = d.x1 - d.x0\n    const h = d.y1 - d.y0\n    return (w >= this.config.minTileSizeForLabel) && (h >= this.config.minTileSizeForLabel)\n  }\n\n  private _getTileLightness (node: TreemapNode<Datum>, siblings: TreemapNode<Datum>[]): number {\n    // Get the value extent of the sibling group\n    const [minValue, maxValue] = extent(siblings, d => d.value)\n\n    // If there's no range or no value, return default lightness\n    if (minValue === maxValue || !node.value) return 0\n\n    // Calculate relative position in the range (0 to 1)\n    // Larger values will be closer to 0 (darker)\n    return this.config.lightnessVariationAmount * ((maxValue - node.value) / (maxValue - minValue))\n  }\n\n  constructor (config?: TreemapConfigInterface<Datum>) {\n    super()\n    if (config) this.setConfig(config)\n    this.tiles = this.g.append('g').attr('class', s.tiles)\n  }\n\n  _render (customDuration?: number): void {\n    super._render(customDuration)\n    const { config, datamodel: { data }, _width, _height } = this\n    const duration = isNumber(customDuration) ? customDuration : config.duration\n\n    if (!config.layers?.length) {\n      console.warn('Unovis | Treemap: No layers defined')\n      return\n    }\n\n    // Map each layer accessor function to get string values from the data array\n    const layerAccessors = config.layers.map(layerAccessor => {\n      return (i: number) => getString(data[i], layerAccessor, i)\n    })\n\n    // Group the data indices by the layer accessors to create a hierarchical structure\n    const nestedData = group(data.keys(), ...layerAccessors as [(d: number) => string])\n\n    // Create the hierarchy from the grouped data,\n    // which by itself is not quite right because there is an extra\n    // level of nesting that we don't want, just above the leaf nodes.\n    const rootNode = hierarchy(nestedData)\n\n    // Compute the aggregation\n    if (config.value) {\n      rootNode.sum(index => isNumber(index) && getNumber(data[index], config.value, index))\n    } else {\n      rootNode.count()\n    }\n\n    // Fix the hierarchy by removing the extra level of nesting\n    rootNode.each(node => {\n      if (!node.children && node.parent) {\n        node.parent.children = null\n      }\n    })\n\n    const treemapLayout = treemap()\n      .size([_width, _height])\n      .round(true)\n      .padding(config.tilePadding)\n\n    // Apply padding to the top of each tile,\n    // but not for the root node.\n    if (this.config.tilePaddingTop !== undefined) {\n      treemapLayout.paddingTop(d => d.parent ? config.tilePaddingTop : 0)\n    }\n\n    // Compute the treemap layout\n    const treemapData = treemapLayout(rootNode) as TreemapNode<Datum>\n\n    // Process the resulting hierarchy into the type we need\n    let nodeId = 0\n    treemapData.each(node => {\n      const n = node as unknown as HierarchyNode<[string, number[]]>\n      // Generate unique IDs for each node\n      node._id = `node-${nodeId++}`\n\n      const treemapDatum: TreemapDatum<Datum> = {\n        key: n.data[0],\n      }\n\n      // Populate the index and datum for leaf nodes\n      const isLeafNode = !n.children\n      if (isLeafNode) {\n        treemapDatum.index = n.data[1][0]\n        treemapDatum.datum = data[treemapDatum.index]\n      }\n\n      node.data = treemapDatum\n    })\n\n    const descendants = treemapData.descendants()\n\n    // Set up the brightness increase scale based on depth\n    const maxDepth = max(descendants, d => d.depth)\n\n    const brightnessIncrease = scaleLinear()\n      .domain([1, maxDepth])\n      .range([0, 1])\n\n    // Get all leaf node values and calculate their square roots\n    // (since area is proportional to value)\n    const leafValues = descendants.filter(d => !d.children).map(d => d.value)\n    const maxLeafValue = Math.sqrt(max(leafValues)) || 0\n    // Divide the range into three equal intervals based on the square root of values\n    // This accounts for the fact that area is proportional to value\n    const fontSizeScale = scaleThreshold<number, number>()\n      .domain([\n        maxLeafValue / 3, // First third of the max value\n        (maxLeafValue * 2) / 3, // Second third of the max value\n      ])\n      .range([\n        config.tileLabelSmallFontSize,\n        config.tileLabelMediumFontSize,\n        config.tileLabelLargeFontSize,\n      ])\n\n    const visibleTiles = descendants.filter(d => d.depth > 0)\n    const firstLevelTiles = visibleTiles.filter(d => d.depth === 1)\n    const nonFirstLevelTiles = visibleTiles.filter(d => d.depth > 1)\n\n    // Set the fill color for the first level tiles\n    firstLevelTiles.forEach((d, i) => {\n      d._fill = getColor(d, config.tileColor, i)\n    })\n\n    // Set the fill color for the non-first level tiles\n    nonFirstLevelTiles.forEach((d, i) => {\n      const providedColor = getColor(d, config.tileColor, i, true)\n      if (providedColor) {\n        d._fill = providedColor\n        return\n      }\n\n      const hslColor = hsl(getHexValue(d.parent?._fill, this.element))\n\n      if (config.enableLightnessVariance && !d.children && d.parent) {\n        const siblings = d.parent.children\n        const lightnessAdjustment = this._getTileLightness(d, siblings)\n        hslColor.l = Math.min(1, hslColor.l + lightnessAdjustment)\n      }\n\n      d._fill = brighter(hslColor.toString(), brightnessIncrease(d.depth))\n    })\n\n\n    // Render tiles\n    const tiles = this.tiles\n      .selectAll<SVGGElement, TreemapNode<Datum>>(`g.${s.tileGroup}`)\n      .data(visibleTiles, d => `${d.data.key}-${d.depth}`)\n\n    const tilesEnter = tiles\n      .enter()\n      .append('g')\n      .attr('class', s.tileGroup)\n\n    // Computes the rect border radius for a given tile.\n    // The rx and ry values are the minimum of the tile\n    // border radius and some fraction the width of the tile,\n    // based on the tileBorderRadiusFactor config.\n    // This ensures that the tile border radius is not\n    // larger than the tile size, which makes small tiles\n    // look better.\n    const getTileBorderRadius = (d: TreemapNode<Datum>): number =>\n      Math.min(config.tileBorderRadius, (d.x1 - d.x0) * config.tileBorderRadiusFactor)\n\n    // Add clipPath elements\n    tilesEnter\n      .append('clipPath')\n      .attr('id', d => `clip-${this.uid}-${d._id}`)\n      .append('rect')\n      .attr('rx', getTileBorderRadius)\n      .attr('ry', getTileBorderRadius)\n\n    // Tile rectangles\n    const tileRects = tilesEnter\n      .append('rect')\n      .classed(s.tile, true)\n      .classed(s.clickableTile, d => config.showTileClickAffordance && !d.children)\n      .attr('rx', getTileBorderRadius)\n      .attr('ry', getTileBorderRadius)\n      .attr('x', d => d.x0)\n      .attr('y', d => d.y0)\n      .attr('width', d => d.x1 - d.x0)\n      .attr('height', d => d.y1 - d.y0)\n      .style('fill', d => d._fill)\n      .style('opacity', 0)\n      .style('cursor', config.showTileClickAffordance ? d => !d.children ? 'pointer' : null : null)\n\n    tileRects.append('title')\n\n    tilesEnter\n      .append('g')\n      .attr('class', s.labelGroup)\n      .attr('clip-path', d => `url(#clip-${this.uid}-${d._id})`)\n      .attr('transform', d => `translate(${d.x0 + config.labelOffsetX},${d.y0 + config.labelOffsetY})`)\n      .style('opacity', 0)\n      .append('text')\n      .attr('class', s.label)\n      .attr('x', 0)\n      .attr('y', 0)\n\n    const mergedTiles = tiles.merge(tilesEnter)\n    const tileRectsMerged = mergedTiles.select(`rect.${s.tile}`)\n    smartTransition(tileRectsMerged, duration)\n      .style('fill', d => d._fill)\n      .style('opacity', 1)\n      .attr('x', d => d.x0)\n      .attr('y', d => d.y0)\n      .attr('width', d => d.x1 - d.x0)\n      .attr('height', d => d.y1 - d.y0)\n\n    tileRectsMerged.select('title')\n      .text(d => config.tileLabel(d))\n\n    // Update clipPath rects\n    mergedTiles.select('clipPath rect')\n      .attr('width', d => d.x1 - d.x0 - 2 * config.labelOffsetX)\n      .attr('height', d => d.y1 - d.y0 - 2 * config.labelOffsetY)\n\n    const textSelection = mergedTiles.selectAll<SVGTextElement, TreemapNode<Datum>>(`g.${s.labelGroup} text`)\n    textSelection\n      .text(d => config.tileLabel(d))\n      .attr('title', d => config.tileLabel(d))\n      .property('font-size-px', d => {\n        const sqrtVal = Math.sqrt(d.value ?? 0)\n        return config.enableTileLabelFontSizeVariation && !d.children\n          ? fontSizeScale(sqrtVal)\n          : null // Use the default css variable value\n      })\n      .style('font-size', (_, i, els) => `${select(els[i]).property('font-size-px')}px`)\n      .style('fill', d => cssvar(\n        isColorDark(d._fill) ? s.variables.treemapLabelTextColorLight : s.variables.treemapLabelTextColor)\n      )\n\n    // Fit label (wrap or trim)\n    textSelection.each((d, i, els) => {\n      const isLeafNode = !d.children\n      const el = els[i] as SVGTextElement\n      const text = select(el)\n      const tileWidth = d.x1 - d.x0 - (config.labelOffsetX ?? 0) * 2\n      const fontSize = parseFloat(text.property('font-size-px')) || parseFloat(window.getComputedStyle(el).fontSize)\n\n      if (config.labelFit === FitMode.Wrap && isLeafNode) {\n        wrapSVGText(text, tileWidth)\n      } else {\n        trimSVGText(text, tileWidth, config.labelTrimMode, true, fontSize)\n      }\n    })\n\n    // Transition group position\n    smartTransition(mergedTiles.select(`g.${s.labelGroup}`), duration)\n      .attr('transform', d => `translate(${d.x0 + config.labelOffsetX},${d.y0 + config.labelOffsetY})`)\n\n    // Transition text opacity only (fade-in)\n    smartTransition(mergedTiles.select(`g.${s.labelGroup}`), duration)\n      .style('opacity', 1)\n\n    // Hide labels that don't meet criteria\n    mergedTiles.select(`text.${s.label}`)\n      .style('display', d => {\n        const isAllowedNode = config.labelInternalNodes ? true : !d.children\n        return isAllowedNode && this._isTileLargeEnough(d) ? null : 'none'\n      })\n      // Make the internal labels semibold via class\n      .attr('class', d => d.children ? `${s.label} ${s.internalLabel}` : s.label)\n\n    smartTransition(tiles.exit(), duration)\n      .style('opacity', 0)\n      .remove()\n  }\n}\n"],"names":["s.tiles","s.tileGroup","s.tile","s.clickableTile","s.labelGroup","s.label","s.variables","s.internalLabel","s"],"mappings":"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"}