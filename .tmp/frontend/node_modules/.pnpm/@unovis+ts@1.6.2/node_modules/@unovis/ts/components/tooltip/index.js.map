{"version":3,"file":"index.js","sources":["../../../src/components/tooltip/index.ts"],"sourcesContent":["import { select, Selection, pointer } from 'd3-selection'\n\n// Core\nimport { ComponentCore } from 'core/component'\n\n// Types\nimport { Position } from 'types/position'\n\n// Utils\nimport { merge, throttle } from 'utils/data'\n\n// Config\nimport { TooltipDefaultConfig, TooltipConfigInterface } from './config'\n\n// Style\nimport * as s from './style'\n\nexport class Tooltip {\n  element: HTMLElement\n  div: Selection<HTMLElement, unknown, null, undefined>\n  protected _defaultConfig = TooltipDefaultConfig as TooltipConfigInterface\n  public config: TooltipConfigInterface = this._defaultConfig\n  prevConfig: TooltipConfigInterface\n  components: ComponentCore<unknown>[]\n  static selectors = s\n  private _setUpEventsThrottled = throttle(this._setUpEvents, 500)\n  private _setContainerPositionThrottled = throttle(this._setContainerPosition, 500)\n  private _isShown = false\n  private _container: HTMLElement\n  private _mutationObserver: MutationObserver\n  private _hoveredElement: HTMLElement | SVGElement\n  private _position: [number, number]\n  private _overriddenHorizontalPlacement: Position.Left | Position.Right | string | undefined\n  private _hideDelayTimeoutId: ReturnType<typeof setTimeout> | undefined\n  private _showDelayTimeoutId: ReturnType<typeof setTimeout> | undefined\n\n  constructor (config: TooltipConfigInterface = {}) {\n    this.element = document.createElement('div')\n    this.div = select(this.element)\n      .attr('class', s.root)\n      .classed(s.show, false)\n      .classed(s.hidden, true)\n\n    this.setConfig(config)\n    this.components = this.config.components\n\n    // Set up MutationObserver to automatically re-position the tooltip\n    // if the content has been dynamically changed\n    this._mutationObserver = new MutationObserver(() => {\n      if (!this._isShown) return\n\n      // Handle changes to the content of this.div\n      // Add your logic here\n      if (!this.config.followCursor && this._hoveredElement) {\n        this.placeByElement(this._hoveredElement)\n      } else if (this._position) {\n        this.place({ x: this._position[0], y: this._position[1] })\n      }\n    })\n\n    this._mutationObserver.observe(this.div.node(), { childList: true, subtree: true })\n  }\n\n  public setConfig (config: TooltipConfigInterface): void {\n    this.prevConfig = this.config\n    this.config = merge(this._defaultConfig, config)\n\n    // Reset `this._overriddenHorizontalPlacement` if the `horizontalPlacement` has changed\n    if (this.prevConfig.horizontalPlacement !== this.config.horizontalPlacement) {\n      this.overrideHorizontalPlacement(undefined)\n    }\n\n    if (this.config.container && (this.config.container !== this.prevConfig?.container)) {\n      this.setContainer(this.config.container)\n    }\n\n    this._setUpAttributes()\n  }\n\n  public setContainer (container: HTMLElement): void {\n    this.element.parentNode?.removeChild(this.element)\n\n    this._container = container\n    this._container.appendChild(this.element)\n\n    this._setContainerPositionThrottled()\n  }\n\n  public getContainer (): HTMLElement {\n    return this._container\n  }\n\n  public hasContainer (): boolean {\n    return !!this._container && this._container.isConnected\n  }\n\n  public setComponents (components: ComponentCore<unknown>[]): void {\n    this.components = components\n  }\n\n  public update (): void {\n    if (!this._container) return\n\n    this._setUpEventsThrottled()\n  }\n\n  /** Show the tooltip immediately by providing content and position */\n  public show (html: string | HTMLElement | null | void, pos: { x: number; y: number }): void {\n    this.render(html)\n    this.place(pos)\n  }\n\n  private _hide (): void {\n    this.div\n      .classed(s.show, false) // The `show` class triggers the opacity transition\n      .on('transitionend', () => {\n        // We hide the element once the transition completes\n        // This ensures container overflow will not occur when the window is resized\n        this.div.classed(s.hidden, !this._isShown)\n      })\n\n    this._isShown = false\n  }\n\n  /** Hides the tooltip after `hideDelay` */\n  public hide (): void {\n    window.clearTimeout(this._showDelayTimeoutId)\n    if (this.config.hideDelay) {\n      window.clearTimeout(this._hideDelayTimeoutId)\n      this._hideDelayTimeoutId = setTimeout(() => this._hide(), this.config.hideDelay)\n    } else {\n      this._hide()\n    }\n  }\n\n  private _display (): void {\n    window.clearTimeout(this._hideDelayTimeoutId)\n    this.div\n      .classed(s.hidden, false) // The `hidden` class sets `display: none;`\n      .classed(s.show, true) // The `show` class triggers the opacity transition\n\n    this._isShown = true\n  }\n\n  /** Simply display the tooltip with its previous content on position, taking into account `showDelay` */\n  public display (): void {\n    if (this._isShown) return\n\n    if (this.config.showDelay) {\n      window.clearTimeout(this._showDelayTimeoutId)\n      this._showDelayTimeoutId = setTimeout(() => {\n        this._display()\n        this.place({ x: this._position[0], y: this._position[1] })\n      }, this.config.showDelay)\n    } else {\n      this._display()\n    }\n  }\n\n  public place (pos: { x: number; y: number }): void {\n    this._position = [pos.x, pos.y]\n\n    if (!this.hasContainer()) {\n      console.warn('Unovis | Tooltip: Container was not set or is not initialized yet')\n      return\n    }\n\n    const { config } = this\n    const tooltipWidth = this.element.offsetWidth\n    const tooltipHeight = this.element.offsetHeight\n\n    const horizontalPlacement = this._overriddenHorizontalPlacement ||\n      (config.horizontalPlacement === Position.Auto\n        ? Position.Center\n        : config.horizontalPlacement)\n\n    const verticalPlacement = config.verticalPlacement === Position.Auto\n      ? ((pos.y - tooltipHeight) < 0 ? Position.Bottom : Position.Top)\n      : config.verticalPlacement\n\n    // Todo: Get rid of the hardcoded margin in version 2.0\n    // Can be simply replaced with `verticalShift` and `horizontalShift`\n    // but it'll be a breaking change\n    const margin = 5\n    const translateX = horizontalPlacement === Position.Left ? -tooltipWidth - margin - config.horizontalShift\n      : horizontalPlacement === Position.Center ? -tooltipWidth / 2\n        : margin + config.horizontalShift\n\n    const translateY = verticalPlacement === Position.Bottom ? margin + config.verticalShift\n      : verticalPlacement === Position.Center ? -tooltipHeight / 2\n        : -margin - config.verticalShift - tooltipHeight\n\n    // translateX and translateY variables shift the tooltip from the default position (above the cursor, centred horizontally)\n    const [top, left] = this._constraintPosToContainer(pos.x + translateX, pos.y + translateY, tooltipWidth, tooltipHeight)\n    this._applyPosition(top, left, tooltipHeight)\n  }\n\n  public placeByElement (hoveredElement: SVGElement | HTMLElement): void {\n    const { config } = this\n\n    // Store the hovered element and the event for future reference,\n    // i.e. to re-position the tooltip if the content has been changed\n    // by something else and it was captured by the MutationObserver\n    this._hoveredElement = hoveredElement\n\n    // Todo: Get rid of the hardcoded margin in version 2.0\n    // Can be simply replaced with `verticalShift` and `horizontalShift`\n    // but it'll be a breaking change\n    const margin = 5\n    const tooltipWidth = this.element.offsetWidth\n    const tooltipHeight = this.element.offsetHeight\n    const isContainerBody = this.isContainerBody()\n    const containerWidth = isContainerBody ? window.innerWidth : this._container.scrollWidth\n    const hoveredElementRect = hoveredElement.getBoundingClientRect()\n\n    // We use D3's point transformation to get the correct position of the element by pretending it's a pointer event\n    // See more: https://github.com/d3/d3-selection/blob/main/src/pointer.js\n    const elementPos = isContainerBody ? [hoveredElementRect.x, hoveredElementRect.y] : pointer({\n      clientX: hoveredElementRect.x,\n      clientY: hoveredElementRect.y,\n      pageX: hoveredElementRect.x,\n      pageY: hoveredElementRect.y,\n    }, this._container)\n\n    const horizontalPlacement = this._overriddenHorizontalPlacement || (\n      config.horizontalPlacement === Position.Auto\n        ? (elementPos[0] - tooltipWidth < 0 ? Position.Right\n          : elementPos[0] + tooltipWidth > containerWidth ? Position.Left : Position.Center)\n        : config.horizontalPlacement\n    )\n\n    let translateX = 0\n    switch (horizontalPlacement) {\n      case Position.Left:\n        translateX = -tooltipWidth - margin - config.horizontalShift\n        break\n      case Position.Right:\n        translateX = hoveredElementRect.width + margin + config.horizontalShift\n        break\n      case Position.Center:\n      default:\n        translateX = (-tooltipWidth + hoveredElementRect.width) / 2\n        break\n    }\n\n    const verticalPlacement = config.verticalPlacement === Position.Auto\n      ? (horizontalPlacement !== Position.Center ? Position.Center\n        : elementPos[1] - tooltipHeight < 0 ? Position.Bottom : Position.Top)\n      : config.verticalPlacement\n\n    let translateY = -tooltipHeight\n    switch (verticalPlacement) {\n      case Position.Center:\n        translateY += (tooltipHeight + hoveredElementRect.height) / 2\n        break\n      case Position.Bottom:\n        translateY += tooltipHeight + hoveredElementRect.height + margin + config.verticalShift\n        break\n      case Position.Top:\n      default:\n        translateY += -margin - config.verticalShift\n        break\n    }\n\n    const [top, left] = this._constraintPosToContainer(elementPos[0] + translateX, elementPos[1] + translateY, tooltipWidth, tooltipHeight)\n    this._applyPosition(top, left, tooltipHeight)\n  }\n\n  public isContainerBody (): boolean {\n    return this._container === document.body\n  }\n\n  /** Allows to override the horizontal placement of the tooltip which is useful when you want to define custom positioning behavior.\n   * This method has been added for Crosshair to allow it position tooltip left or right of the crosshair line\n   * (see the `_showTooltip` method of the Crosshair component).\n   */\n  public overrideHorizontalPlacement (placement: Position.Left | Position.Right | string | undefined): void {\n    this._overriddenHorizontalPlacement = placement\n  }\n\n  public render (html: string | HTMLElement | null | void): void {\n    const { config, prevConfig } = this\n    if (html instanceof HTMLElement) {\n      const node = this.div.select(':first-child').node()\n      if (node !== html) this.div.html('').append(() => html)\n    } else if (html !== null) {\n      this.div.html(html || '')\n    }\n\n    this.div\n      .classed(config.className ?? '', Boolean(config.className))\n      .classed(s.nonInteractive, !config.allowHover)\n\n    // Remove the previous class name if it was set\n    if (prevConfig?.className && prevConfig.className !== config.className) {\n      this.div.classed(prevConfig.className, false)\n    }\n\n    this.display()\n  }\n\n  private _applyPosition (x: number, y: number, tooltipHeight: number): void {\n    const isContainerBody = this.isContainerBody()\n    const containerHeight = isContainerBody ? window.innerHeight : this._container.scrollHeight\n\n    this.div\n      .classed(s.positionFixed, isContainerBody)\n      .style('top', isContainerBody ? `${y}px` : 'unset')\n      .style('bottom', !isContainerBody ? `${containerHeight - y - tooltipHeight}px` : 'unset')\n      .style('left', `${x}px`)\n  }\n\n  private _constraintPosToContainer (top: number, left: number, tooltipWidth: number, tooltipHeight: number): [number, number] {\n    const isContainerBody = this.isContainerBody()\n    const containerHeight = isContainerBody ? window.innerHeight : this._container.scrollHeight\n    const containerWidth = isContainerBody ? window.innerWidth : this._container.scrollWidth\n\n    // // Constraint to container\n    const paddingX = 10\n    const hitRight = top > (containerWidth - tooltipWidth - paddingX)\n    const hitLeft = top < paddingX\n    const constrainedLeft = hitRight ? containerWidth - tooltipWidth - paddingX\n      : hitLeft ? paddingX : top\n\n    const paddingY = 10\n    const hitBottom = left > (containerHeight - tooltipHeight - paddingY)\n    const hitTop = left < paddingY\n    const constrainedTop = hitBottom ? containerHeight - tooltipHeight - paddingY\n      : hitTop ? paddingY : left\n\n    return [\n      containerWidth < tooltipWidth ? 0 : constrainedLeft,\n      containerHeight < tooltipHeight ? 0 : constrainedTop,\n    ]\n  }\n\n  private _setContainerPosition (): void {\n    // Tooltip position calculation relies on the parent position\n    // If it's not set (static), we set it to `relative` (not a good practice)\n    if (this._container !== document.body && getComputedStyle(this._container)?.position === 'static') {\n      this._container.style.position = 'relative'\n    }\n  }\n\n  private _setUpEvents (): void {\n    const { config } = this\n\n    // We use the Event Delegation pattern to set up Tooltip events\n    // Every component will have single `mousemove` and `mouseleave` event listener functions, where we'll check\n    // the `path` of the event and trigger corresponding callbacks\n    this.components.forEach(component => {\n      const selection = select(component.element)\n      selection\n        .on('mousemove.tooltip', (e: MouseEvent) => {\n          const { config: currentConfig } = this // get latest config because it could have been changed after the event was triggered\n          const path: (HTMLElement | SVGGElement)[] = (e.composedPath && e.composedPath()) || (e as any).path || [e.target]\n\n          // Go through all of the configured triggers\n          for (const className of Object.keys(currentConfig.triggers)) {\n            const template = currentConfig.triggers[className]\n            if (!template) continue // Skip if the trigger is not configured\n\n            const els = selection.selectAll<HTMLElement | SVGGElement, unknown>(`.${className}`).nodes()\n\n            // Go through all of the elements in the event path (from the deepest element upwards)\n            for (const el of path) {\n              if (el === selection.node()) break // Break on the component's level (usually the `<g>` element)\n              if (el.classList.contains(className)) { // If there's a match, show the tooltip\n                const i = els.indexOf(el)\n                const d = select(el).datum()\n                const content = template(d, i, els)\n                const [x, y] = this.isContainerBody() ? [e.clientX, e.clientY] : pointer(e, this._container)\n                if (content === null) {\n                  // If the content is `null`, we hide the tooltip\n                  this.hide()\n                } else {\n                  // Otherwise we show the tooltip, but don't render the content if it's `undefined` or\n                  // an empty string. This way we can allow it to work with things like `createPortal` in React\n                  this.render(content)\n                  if (currentConfig.followCursor) this.place({ x, y })\n                  else this.placeByElement(el)\n                }\n\n                // Stop propagation to prevent other interfering events from being triggered, e.g. Crosshair\n                e.stopPropagation()\n\n                // Stop looking for other matches\n                return\n              }\n            }\n          }\n\n          // Hide the tooltip if the event didn't pass through any of the configured triggers.\n          // We use the `this._isShown` condition as a little performance optimization tweak\n          // (we don't want the tooltip to update its class on every mouse movement, see `this.hide()`).\n          if (this._isShown) this.hide()\n        })\n        .on('mouseleave.tooltip', (e: MouseEvent) => {\n          e.stopPropagation() // Stop propagation to prevent other interfering events from being triggered, e.g. Crosshair\n          this.hide()\n        })\n    })\n\n    // Set up Tooltip hover\n    if (config.allowHover) {\n      this.div\n        .on('mouseenter.tooltip', this._display.bind(this))\n        .on('mouseleave.tooltip', this.hide.bind(this))\n    } else {\n      this.div\n        .on('mouseenter.tooltip', null)\n        .on('mouseleave.tooltip', null)\n    }\n  }\n\n  private _setUpAttributes (): void {\n    const attributesMap = this.config.attributes\n    if (!attributesMap) return\n\n    Object.keys(attributesMap).forEach(attr => {\n      this.div.attr(attr, attributesMap[attr])\n    })\n  }\n\n  public destroy (): void {\n    this._mutationObserver.disconnect()\n    window.clearTimeout(this._hideDelayTimeoutId)\n    window.clearTimeout(this._showDelayTimeoutId)\n    this.div?.remove()\n  }\n}\n"],"names":["s.root","s.show","s.hidden","s.nonInteractive","s.positionFixed","s"],"mappings":"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"}